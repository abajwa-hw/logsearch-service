<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>

<!-- This is a special config file for properties used to monitor status of the service -->
<configuration>

  <property>
    <name>logfeeder_pid_dir</name>
    <value>/var/run/logfeeder</value>
    <description>logfeeder Process ID Directory</description>
  </property> 

  <property>
    <name>logfeeder_log_dir</name>
    <value>/var/log/logfeeder</value>
    <description>Log dir for logfeeder</description>
  </property> 
  
  <property>
    <name>logfeeder_user</name>
    <value>logfeeder</value>
    <property-type>USER</property-type>
    <description>logfeeder user</description>
  </property>  

  <property>
    <name>logfeeder_group</name>
    <value>logfeeder</value>
    <property-type>GROUP</property-type>
    <description>logfeeder group</description>
  </property> 


  <!-- system.properties -->

  <property>
    <name>content</name>
    <description>This is the jinja template for config.json file</description>
    <value>
{
    "global" : {
        "add_fields" : { "cluster": "unknown", "rowtype" : "service"},
        "source" : "file",
        "tail" : "true",
        "start_position" : "beginning"
    },
    "input": [
        {
            "type": "ranger_admin",
            "path": "{{ranger_admin_log_dir}}/admin/xa_portal.log"
        },
        {
            "type": "ranger_usersync",
            "path": "{{ranger_usersync_log_dir}}/usersync/usersync.log"
        },    
        {
            "type": "ranger_kms",
            "path": "{{ranger_kms_log_dir}}/kms/kms.log"
        },    
        {
            "type": "hdfs_datanode",
            "path": "{{hdfs_log_dir_prefix}}/hdfs/hadoop-hdfs-datanode-*.log"
        },  
        {
            "type": "hdfs_namenode",
            "path": "{{hdfs_log_dir_prefix}}/hdfs/hadoop-hdfs-namenode-*.log"
        },  
        {
            "type": "hdfs_journalnode",
            "path": "{{hdfs_log_dir_prefix}}/hdfs/hadoop-hdfs-journalnode-*.log"
        },              
        {
            "type": "hdfs_secondarynamenode",
            "path": "{{hdfs_log_dir_prefix}}/hdfs/hadoop-hdfs-secondarynamenode-*.log"
        },             
        {
            "type": "hdfs_zkfc",
            "path": "{{hdfs_log_dir_prefix}}/hdfs/hadoop-hdfs-zkfc-*.log"
        },             
        {
            "type": "yarn_nodemanager",
            "path": "{{yarn_log_dir_prefix}}/yarn/yarn-yarn-nodemanager-*.log"
        },             
        {
            "type": "yarn_resourcemanager",
            "path": "{{yarn_log_dir_prefix}}/yarn/yarn-yarn-resourcemanager-*.log"
        },             
        {
            "type": "yarn_timelineserver",
            "path": "{{yarn_log_dir_prefix}}/yarn/yarn-yarn-timelineserver-*.log"
        },    
        {
            "type": "yarn_historyserver",
            "path": "{{yarn_log_dir_prefix}}/yarn/yarn-yarn-historyserver-*.log"
        },   
        {
            "type": "yarn_jobsummary",
            "path": "{{yarn_log_dir_prefix}}/yarn/hadoop-mapreduce.jobsummary.log"
        }, 
        {
            "type": "mapred_historyserver",
            "path": "{{hdfs_log_dir_prefix}}/mapred/mapred-mapred-historyserver*.log"
        },         
        {
            "type": "zookeeper",
            "path": "{{zk_log_dir}}/zookeeper/zookeeper.out"
        },   
        {
            "type": "hbase_master",
            "path": "{{hbase_log_dir}}/hbase-hbase-master-*.log"
        },           
        {
            "type": "hbase_region",
            "path": "{{hbase_log_dir}}/hbase-hbase-regionserver-*.log"
        },                                                     
        {
            "type": "logsearch_portal",
            "path": "{{logsearch_log_dir}}/logsearch.log"
        }
    ],
    "filter": [
        {
            "filter" : "grok",
            "conditions": [{"type": ["ranger_admin"]}],
            "multiline_pattern" : "^(%{TIMESTAMP_ISO8601:logtime})",
            "message_pattern": "(?m)(?s)^%{TIMESTAMP_ISO8601:logtime}%{SPACE}\\[%{DATA:thread_name}\\]%{SPACE}%{LOGLEVEL:level}%{SPACE}%{JAVACLASS:logger_name}%{SPACE}\\(%{JAVAFILE:file}:%{INT:line_number}\\)%{SPACE}-%{SPACE}%{GREEDYDATA:log_message}"
        }
    ],
    "output": [
        {
            "destination" : "solr",
            "zk_hosts" : "{{zookeeper_quorum}}{{solr_znode}}",
            "collection" : "hadoop_logs",
            "url": ""
        }
    ]
}
    </value>
  </property>

  
</configuration>  